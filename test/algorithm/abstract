The following tests, unless stated otherwise, were written by ping and refactored by bayanmehr